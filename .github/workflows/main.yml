name: Gladiatus Bot (Cache + Debug)

on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:

env:
  # Definimos una ruta fija para la caché de Puppeteer
  PUPPETEER_CACHE_DIR: ~/.cache/puppeteer

jobs:
  visit-profile:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout código
        uses: actions/checkout@v3

      - name: Instalar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      # --- PASO DE CACHÉ (NUEVO) ---
      # Esto guarda el navegador descargado para no bajarlo cada vez
      - name: Restaurar caché de Puppeteer
        uses: actions/cache@v3
        id: puppeteer-cache
        with:
          path: ~/.cache/puppeteer
          key: ${{ runner.os }}-puppeteer-${{ hashFiles('package.json') }}

      - name: Instalar dependencias
        # Si no hay caché, se descarga todo. Si hay caché, va volando.
        run: npm install

      - name: Ejecutar Bot (con FOTO)
        run: node index.js

      # --- SUBIR LA FOTO ---
      # Fundamental para ver si nos sale un Captcha o error
      - name: Subir Evidencia
        if: always() # Se ejecuta aunque el bot falle
        uses: actions/upload-artifact@v4
        with:
          name: evidencia-visita
          path: evidence.png
